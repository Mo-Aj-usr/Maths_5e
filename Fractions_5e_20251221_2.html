<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maths 5e - MoA-EIC : QCM Fractions (20 questions)</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --c-bg: #f4f7ff;
      --c-card: #ffffff;
      --c-primary: #3f51b5;
      --c-primary-light: #e8eaf6;
      --c-secondary: #ff9800;
      --c-good: #4caf50;
      --c-bad: #f44336;
      --c-text: #222;
      --c-muted: #666;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top left, #e3f2fd, #fce4ec 60%, #f4f7ff);
      min-height: 100vh;
      font-family: "Segoe UI", system-ui, sans-serif;
      color: var(--c-text);
      padding: 20px 10px;
    }
    .app {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--c-card);
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.15);
      padding: 30px;
      position: relative;
      overflow: hidden;
    }
    .app::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(63,81,181,0.06), rgba(255,152,0,0.06));
      pointer-events: none;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 2rem;
      color: var(--c-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    h1 span.logo-dot {
      width: 16px; height: 16px; border-radius: 50%;
      background: linear-gradient(135deg, #ff9800, #ff5722);
    }
    .subtitle { margin: 0 0 20px; color: var(--c-muted); font-size: 1rem; }
    .tag-row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .tag {
      font-size: 0.85rem; padding: 6px 12px; border-radius: 999px;
      background: var(--c-primary-light); color: var(--c-primary);
      display: inline-flex; align-items: center; gap: 6px;
    }
    .tag orange { background: rgba(255,152,0,0.12); color: var(--c-secondary); }
    .tag.green { background: rgba(76,175,80,0.08); color: var(--c-good); }
    .tag-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }

    .progress-bar { margin: 20px 0; }
    .progress-track { height: 12px; border-radius: 999px; background: #e0e7ff; overflow: hidden; }
    .progress-fill {
      height: 100%; width: 0%; border-radius: 999px;
      background: linear-gradient(90deg, #3f51b5, #ff9800);
      transition: width 0.4s ease;
    }
    .progress-labels { display: flex; justify-content: space-between; margin-top: 6px; font-size: 0.9rem; color: var(--c-muted); }

    .questions-container { position: relative; z-index: 1; }

    .question-block {
      background: #f8f9ff;
      border: 1px solid #e0e7ff;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .question-title {
      font-size: 1.15rem;
      font-weight: 600;
      color: #1a237e;
      flex: 1;
    }
    .question-meta {
      font-size: 0.85rem;
      color: var(--c-muted);
      text-align: right;
    }
    .pill-level {
      padding: 4px 10px; border-radius: 999px; background: rgba(255,152,0,0.1);
      color: var(--c-secondary); font-size: 0.8rem;
    }

    .answers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    .answer {
      position: relative;
    }
    .answer input { display: none; }
    .answer-label {
      display: block; padding: 12px 16px; border-radius: 12px;
      border: 1px solid #d1d9ff; background: #fff;
      cursor: pointer; transition: all 0.2s;
      display: flex; align-items: flex-start; gap: 10px;
    }
    .answer-bullet {
      width: 20px; height: 20px; border-radius: 50%;
      border: 2px solid #c5cae9; flex-shrink: 0; margin-top: 2px;
      position: relative;
    }
    .answer-bullet::after {
      content: ""; position: absolute; inset: 4px; border-radius: 50%;
      background: transparent; transition: background 0.2s;
    }
    .answer input:checked + .answer-label {
      border-color: var(--c-primary); background: var(--c-primary-light);
    }
    .answer input:checked + .answer-label .answer-bullet {
      border-color: var(--c-primary);
    }
    .answer input:checked + .answer-label .answer-bullet::after {
      background: var(--c-primary);
    }

    .feedback {
      min-height: 24px; font-size: 0.92rem; padding: 8px 0;
    }
    .feedback.good { color: var(--c-good); font-weight: 500; }
    .feedback.bad { color: var(--c-bad); font-weight: 500; }

    .question-indexes {
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
      margin: 30px 0 10px;
    }
    .question-index {
      width: 32px; height: 32px; border-radius: 50%;
      background: #fff; border: 1px solid #c5cae9;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.85rem; color: var(--c-primary);
      transition: all 0.2s;
    }
    .question-index.answered { background: #e8f5e9; border-color: var(--c-good); color: var(--c-good); }
    .question-index.correct { background: var(--c-good); color: #fff; border-color: var(--c-good); }
    .question-index.wrong { background: var(--c-bad); color: #fff; border-color: var(--c-bad); }

    .score-global {
      text-align: center; font-size: 1.3rem; margin: 20px 0;
      font-weight: 600; color: var(--c-primary);
    }
    .score-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: 999px;
      background: rgba(76,175,80,0.15); color: var(--c-good);
      font-size: 1.1rem;
    }

    @media (max-width: 720px) {
      .app { padding: 20px; }
      h1 { font-size: 1.6rem; }
      .answers { grid-template-columns: 1fr; }
      .question-header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1><span class="logo-dot"></span>Maths 5e MoA-EIC : QCM Fractions</h1>
    <p class="subtitle">20 questions – Toutes affichées sur cette page</p>
    <div class="tag-row">
      <div class="tag"><span class="tag-dot"></span>Écritures fractionnaires & décimales</div>
      <div class="tag orange"><span class="tag-dot"></span>Comparaisons & opérations</div>
      <div class="tag green"><span class="tag-dot"></span>Problèmes concrets</div>
    </div>

    <div class="progress-bar">
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-labels">
        <span id="answeredText">0 question répondue</span>
        <span id="scoreText">Score : 0 / 20</span>
      </div>
    </div>

    <div class="score-global" id="scoreGlobal">
      Score final : <span class="score-badge" id="scoreBadge">0 / 20</span>
    </div>

    <div class="question-indexes" id="questionIndexes"></div>

    <div class="questions-container" id="questionsContainer"></div>
  </div>

  <script>
    const questions = [ /* même tableau que dans votre code original */ 
      {
        text: "Quelle écriture décimale correspond à \\(\\dfrac{23}{10}\\) ?",
        type: "Écriture fractionnaire / décimale",
        difficulty: "1",
        options: ["2,3", "0,23", "23,0", "2,03"],
        correct: 0,
        feedbackGood: "Bonne idée : 23 ÷ 10 = 2,3.",
        feedbackBad: "Diviser par 10 revient à déplacer la virgule d’un rang vers la gauche : 23 ÷ 10 = 2,3."
      },
      {
        text: "Quelle fraction est égale à 0,75 ?",
        type: "Écriture fractionnaire / décimale",
        difficulty: "1",
        options: ["\\(\\dfrac{3}{4}\\)", "\\(\\dfrac{75}{10}\\)", "\\(\\dfrac{7}{5}\\)", "\\(\\dfrac{4}{3}\\)"],
        correct: 0,
        feedbackGood: "0,75 = 75/100 = 3/4 après simplification.",
        feedbackBad: "Écris 0,75 sous forme 75/100 puis simplifie par 25 pour obtenir 3/4."
      },
      /* ... les 18 autres questions identiques à votre code ... */
      {
        text: "On sait que \\(\\dfrac{a}{b} = \\dfrac{3}{4}\\) avec a, b entiers positifs. Laquelle de ces égalités est possible ?",
        type: "Fractions égales / proportion",
        difficulty: "3",
        options: [
          "a = 9 et b = 12",
          "a = 6 et b = 10",
          "a = 15 et b = 25",
          "a = 8 et b = 10"
        ],
        correct: 0,
        feedbackGood: "9/12 = 3/4 après simplification par 3.",
        feedbackBad: "Teste les fractions en les simplifiant pour voir laquelle donne 3/4."
      }
    ];

    const userAnswers = new Array(questions.length).fill(null); // index de la réponse choisie
    const checked = new Array(questions.length).fill(false);     // corrigée ou non

    const progressFill = document.getElementById("progressFill");
    const answeredText = document.getElementById("answeredText");
    const scoreText = document.getElementById("scoreText");
    const scoreBadge = document.getElementById("scoreBadge");
    const questionIndexes = document.getElementById("questionIndexes");
    const questionsContainer = document.getElementById("questionsContainer");

    function difficultyLabel(d) {
      return d === "1" ? "Facile" : d === "2" ? "Standard" : "Avancé";
    }

    function updateGlobal() {
      const answeredCount = userAnswers.filter(a => a !== null).length;
      const correctCount = userAnswers.reduce((sum, ans, i) => 
        checked[i] && ans === questions[i].correct ? sum + 1 : sum, 0);

      const percent = (answeredCount / questions.length) * 100;
      progressFill.style.width = percent + "%";
      answeredText.textContent = `${answeredCount} question${answeredCount > 1 ? "s" : ""} répondue${answeredCount > 1 ? "s" : ""}`;
      scoreText.textContent = `Score : ${correctCount} / ${questions.length}`;
      scoreBadge.textContent = `${correctCount} / ${questions.length}`;

      // mise à jour des index
      questionIndexes.innerHTML = "";
      questions.forEach((_, i) => {
        const div = document.createElement("div");
        div.className = "question-index";
        div.textContent = i + 1;
        if (userAnswers[i] !== null) div.classList.add("answered");
        if (checked[i]) {
          div.classList.add(userAnswers[i] === questions[i].correct ? "correct" : "wrong");
        }
        div.addEventListener("click", () => window.scrollTo({ top: document.getElementById(`q${i}`).offsetTop - 100, behavior: "smooth" }));
        questionIndexes.appendChild(div);
      });
    }

    questions.forEach((q, qIndex) => {
      const block = document.createElement("div");
      block.className = "question-block";
      block.id = `q${qIndex}`;

      block.innerHTML = `
        <div class="question-header">
          <div class="question-title">${qIndex + 1}. ${q.text}</div>
          <div class="question-meta">
            <div>Type : ${q.type}</div>
            <div>Difficulté : <span class="pill-level">${difficultyLabel(q.difficulty)}</span></div>
          </div>
        </div>
        <div class="answers" id="answers${qIndex}"></div>
        <div class="feedback" id="feedback${qIndex}"></div>
      `;

      const answersDiv = block.querySelector(`#answers${qIndex}`);
      q.options.forEach((opt, optIndex) => {
        const div = document.createElement("div");
        div.className = "answer";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = `q${qIndex}`;
        input.id = `q${qIndex}_a${optIndex}`;
        input.value = optIndex;

        const label = document.createElement("label");
        label.htmlFor = input.id;
        label.className = "answer-label";
        label.innerHTML = `<div class="answer-bullet"></div><div class="answer-text">${opt}</div>`;

        input.addEventListener("change", () => {
          userAnswers[qIndex] = optIndex;
          checked[qIndex] = false; // réinitialise la correction si on change
          block.querySelector(`#feedback${qIndex}`).textContent = "";
          block.querySelector(`#feedback${qIndex}`).className = "feedback";
          updateGlobal();
        });

        div.appendChild(input);
        div.appendChild(label);
        answersDiv.appendChild(div);
      });

      // bouton Corriger (facultatif mais utile)
      const correctBtn = document.createElement("button");
      correctBtn.textContent = "Corriger cette question";
      correctBtn.style = "margin-top: 10px; padding: 8px 16px; border: none; border-radius: 999px; background: var(--c-primary); color: white; cursor: pointer;";
      correctBtn.onclick = () => {
        if (userAnswers[qIndex] === null) {
          block.querySelector(`#feedback${qIndex}`).textContent = "Choisis d’abord une réponse.";
          block.querySelector(`#feedback${qIndex}`).className = "feedback bad";
          return;
        }
        checked[qIndex] = true;
        const feedbackEl = block.querySelector(`#feedback${qIndex}`);
        if (userAnswers[qIndex] === q.correct) {
          feedbackEl.textContent = q.feedbackGood;
          feedbackEl.className = "feedback good";
        } else {
          feedbackEl.textContent = q.feedbackBad;
          feedbackEl.className = "feedback bad";
        }
        updateGlobal();
      };
      block.appendChild(correctBtn);

      questionsContainer.appendChild(block);
    });

    // MathJax pour rendre les formules
    MathJax.typesetPromise();

    updateGlobal();
  </script>
</body>
</html>